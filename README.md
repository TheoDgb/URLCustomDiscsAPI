# URLCustomDiscsAPI
API for the URLCustomDiscs plugin, allowing Minecraft servers to register via a unique token and dynamically generate custom resource packs based on user-submitted URLs.\
The API uses yt-dlp and FFmpeg to download and convert audio files, which are then added as custom audio discs (which can also be removed) to a dedicated resource pack hosted on Cloudflare R2.\
This enables servers to serve up-to-date custom discs in real time, allowing players to automatically receive new audio content without restarting or reinstalling anything.

## URLCustomDiscs Plugin
The **URLCustomDiscs.jar** plugin is available for download in the [**Releases**](https://github.com/TheoDgb/URLCustomDiscs/releases) section of the [URLCustomDiscs GitHub repository](https://github.com/TheoDgb/URLCustomDiscs).\
It is also available on [Modrinth](https://modrinth.com/plugin/url-custom-discs) ([**Versions**](https://modrinth.com/plugin/url-custom-discs/versions)).

## Dependencies
### License & Attribution
This API uses the following external tools:
- **yt-dlp** from the [yt-dlp GitHub repository](https://github.com/yt-dlp/yt-dlp) under the [Unlicense](https://github.com/yt-dlp/yt-dlp/blob/master/LICENSE)
- **FFmpeg** from the [FFmpeg Static Builds](https://johnvansickle.com/ffmpeg/) under the [GNU General Public License version 3 (GPLv3)](https://www.gnu.org/licenses/gpl-3.0.html)
### Tool Usage
- **yt-dlp** is used to download MP3 audio files from YouTube URLs.
- **FFmpeg** is used to convert MP3 files to Ogg format.

## Features
- Register Minecraft servers and manage resource packs.
- Dynamically add and remove custom audio discs.
- Support for external tools yt-dlp and FFmpeg for audio downloading and conversion.
- Automatic updates of yt-dlp.
- Storage and hosting of resource packs via Cloudflare R2.
- Rate limiting and request queuing per server token to maintain API stability and data integrity.

## Token Authentication
Every request to the API must include a token that uniquely identifies a registered Minecraft server.
- Purpose: The token ensures that each server has isolated access to its own resource pack and data.
- Usage: The token must be included in the JSON body of the request.
- Generated by: A unique token is generated and assigned when a Minecraft server registers for the first time by creating a custom disc.
- Required for:
  - Identifying the server and its associated resource pack.
  - Uploading a custom disc in the resource pack.
  - Removing disc from the resource pack.
  - Handling rate limiting and request queuing (applied per token).

## Rate Limiting
To prevent request spamming, the API enforces rate limiting per token:
- Maximum 6 requests per minute per token.
- If this limit is exceeded, the API doesn't add the request to the request queue.

## Request Queue
To avoid conflicts when modifying resource packs, the API processes requests sequentially per token using a request queue:
- Requests for the same token are enqueued and handled one at a time.
- This ensures resource pack consistency and prevents race conditions.

## API Response & Error Handling
The API returns clear JSON responses indicating success or failure for each request.\
Errors such as rate limit exceeded, invalid tokens, or internal server issues are properly handled and communicated with appropriate HTTP status codes and messages.

## Installation & Setup
Create your own .env with .env.example, then:
```
npm init -y
npm install express cors body-parser uuid @aws-sdk/client-s3 dotenv tar lzma-native extract-zip adm-zip
npm start
```

## Commands Used
```
npm init -y
npm install express cors body-parser
npm install uuid

SDK AWS S3
npm install @aws-sdk/client-s3

npm install dotenv
npm install tar
npm install lzma-native
npm install extract-zip
npm install adm-zip

npm start
```